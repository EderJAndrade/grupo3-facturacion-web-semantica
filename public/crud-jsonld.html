<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>CRUD Facturación JSON-LD - grupo3</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
h2 { margin-top: 0; }
input, button { width: 100%; margin: 4px 0; padding: 6px; }
pre { background: #f4f4f4; padding: 10px; white-space: pre-wrap; }
</style>
</head>
<body>

<h1>CRUD Facturación con Web Semántica (JSON-LD) – grupo3</h1>

<!-- ================= CLIENTE ================= -->
<section>
<h2>Cliente</h2>

<input id="c_id" placeholder="ID Cliente (para ver/actualizar/eliminar)">
<input id="c_nombre" placeholder="Nombre">
<input id="c_email" placeholder="Email">

<button onclick="crearCliente()">Crear Cliente</button>
<button onclick="verCliente()">Ver Cliente</button>
<button onclick="actualizarCliente()">Actualizar Cliente</button>
<button onclick="eliminarCliente()">Eliminar Cliente</button>
</section>

<!-- ================= PRODUCTO ================= -->
<section>
<h2>Producto</h2>

<input id="p_id" placeholder="ID Producto (para ver/actualizar/eliminar)">
<input id="p_codigo" placeholder="Código">
<input id="p_nombre" placeholder="Nombre">
<input id="p_precio" placeholder="Precio Unitario">
<input id="p_stock" placeholder="Stock">

<button onclick="crearProducto()">Crear Producto</button>
<button onclick="verProducto()">Ver Producto</button>
<button onclick="actualizarProducto()">Actualizar Producto</button>
<button onclick="eliminarProducto()">Eliminar Producto</button>
</section>

<!-- ================= FACTURA ================= -->
<section>
<h2>Factura</h2>

<input id="f_id" placeholder="ID Factura (para ver/actualizar/eliminar)">
<input id="f_numero" placeholder="Número">
<input id="f_cliente" placeholder="ID Cliente">
<input id="f_fecha" placeholder="Fecha (YYYY-MM-DD)">
<input id="f_sub" placeholder="SubTotal">
<input id="f_imp" placeholder="Impuesto">
<input id="f_total" placeholder="Total">
<input id="f_estado" placeholder="Estado (pendiente, pagada, anulada)">

<button onclick="crearFactura()">Crear Factura</button>
<button onclick="verFactura()">Ver Factura</button>
<button onclick="actualizarFactura()">Actualizar Factura</button>
<button onclick="eliminarFactura()">Eliminar Factura</button>
</section>

<!-- ================= DETALLE FACTURA ================= -->
<section>
<h2>Detalle Factura</h2>

<input id="d_id" placeholder="ID Detalle (para ver/actualizar/eliminar)">
<input id="d_factura" placeholder="ID Factura">
<input id="d_producto" placeholder="ID Producto">
<input id="d_cantidad" placeholder="Cantidad">
<input id="d_precio" placeholder="Precio Unitario">

<button onclick="crearDetalle()">Crear Detalle</button>
<button onclick="verDetalle()">Ver Detalle</button>
<button onclick="actualizarDetalle()">Actualizar Detalle</button>
<button onclick="eliminarDetalle()">Eliminar Detalle</button>
</section>

<h2>Respuesta JSON-LD</h2>
<pre id="out">Aquí aparecerá el JSON-LD devuelto por la API…</pre>

<script>
const out = document.getElementById('out');

function mostrar(data) {
  out.textContent = JSON.stringify(data, null, 2);

  const old = document.querySelector('script[type="application/ld+json"]');
  if (old) old.remove();

  const s = document.createElement('script');
  s.type = 'application/ld+json';
  s.textContent = JSON.stringify(data, null, 2);
  document.head.appendChild(s);
}

/* ================= CLIENTE ================= */
async function crearCliente() {
  const r = await fetch('/api/clientes', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      nombre: c_nombre.value,
      email: c_email.value
    })
  });
  mostrar(await r.json());
}

async function verCliente() {
  const r = await fetch(`/api/clientes/${c_id.value}`);
  mostrar(await r.json());
}

async function actualizarCliente() {
  const r = await fetch(`/api/clientes/${c_id.value}`, {
    method: 'PUT',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      nombre: c_nombre.value,
      email: c_email.value
    })
  });
  mostrar(await r.json());
}

async function eliminarCliente() {
  const r = await fetch(`/api/clientes/${c_id.value}`, { method:'DELETE' });
  mostrar(await r.json());
}

/* ================= PRODUCTO ================= */
async function crearProducto() {
  const r = await fetch('/api/productos', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      codigo:p_codigo.value,
      nombre:p_nombre.value,
      precio_unitario:p_precio.value,
      stock:p_stock.value
    })
  });
  mostrar(await r.json());
}

async function verProducto() {
  const r = await fetch(`/api/productos/${p_id.value}`);
  mostrar(await r.json());
}

async function actualizarProducto() {
  const r = await fetch(`/api/productos/${p_id.value}`, {
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      nombre:p_nombre.value,
      precio_unitario:p_precio.value,
      stock:p_stock.value
    })
  });
  mostrar(await r.json());
}

async function eliminarProducto() {
  const r = await fetch(`/api/productos/${p_id.value}`, { method:'DELETE' });
  mostrar(await r.json());
}

/* ================= FACTURA ================= */
async function crearFactura() {
  const r = await fetch('/api/facturas', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      numero:f_numero.value,
      cliente_id:f_cliente.value,
      fecha:f_fecha.value,
      sub_total:f_sub.value,
      impuesto:f_imp.value,
      total:f_total.value,
      detalle:[]
    })
  });
  mostrar(await r.json());
}

async function verFactura() {
  const r = await fetch(`/api/facturas/${f_id.value}`);
  mostrar(await r.json());
}

async function actualizarFactura() {
  const r = await fetch(`/api/facturas/${f_id.value}`, {
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      estado:f_estado.value
    })
  });
  mostrar(await r.json());
}

async function eliminarFactura() {
  const r = await fetch(`/api/facturas/${f_id.value}`, { method:'DELETE' });
  mostrar(await r.json());
}

/* ================= DETALLE ================= */
async function crearDetalle() {
  const r = await fetch('/api/detalle-facturas', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      factura_id:d_factura.value,
      producto_id:d_producto.value,
      cantidad:d_cantidad.value,
      precio_unitario:d_precio.value
    })
  });
  mostrar(await r.json());
}

async function verDetalle() {
  const r = await fetch(`/api/detalle-facturas/${d_id.value}`);
  mostrar(await r.json());
}

async function actualizarDetalle() {
  const r = await fetch(`/api/detalle-facturas/${d_id.value}`, {
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      cantidad:d_cantidad.value,
      precio_unitario:d_precio.value
    })
  });
  mostrar(await r.json());
}

async function eliminarDetalle() {
  const r = await fetch(`/api/detalle-facturas/${d_id.value}`, { method:'DELETE' });
  mostrar(await r.json());
}
</script>

</body>
</html>
